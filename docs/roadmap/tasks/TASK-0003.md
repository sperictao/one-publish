# TASK-0003: Rust Unit Tests + Testable Publish Planning Layer

Status: doing
Owner: OpenClaw
Links:
- PR: (commit in main)

## Context

The Rust backend will eventually host the execution engine and provider system. We need a stable, testable planning layer before we scale behavior.

## Goals

- Ensure `cargo test` runs and includes real unit tests.
- Introduce a small pure planning function (no IO) that can be tested deterministically.
- Refactor command execution to use the planning function.

## Non-Goals

- Real execution plan abstraction (tracked in Phase 1 tasks).
- Mocking the `dotnet` process in tests.

## Requirements

### Functional

- R1: Publishing command arguments are generated deterministically.
- R2: Publish profile mode and flag mode are covered.

### Non-Functional

- N1: Tests do not require `dotnet` installed.
- N2: No filesystem IO in the plan builder.

## Technical Design

- Add `src-tauri/src/publish.rs`:
  - `build_dotnet_publish_plan(project_path, config) -> DotnetPublishPlan`
  - Unit tests for profile mode and flag mode.
- Wire `commands::execute_publish` to use `publish::build_dotnet_publish_plan`.

## TDD Plan

### Test cases

- [ ] When `use_profile=true` and `profile_name` set, args include `/p:PublishProfile=...` and exclude other flags.
- [ ] When `use_profile=false`, args include `-c <configuration>` and optional `--runtime`, `--self-contained`, `-o <output>`.

### Test types

- Unit: `cargo test`

## Acceptance Criteria

- [ ] AC1: `cargo test --manifest-path src-tauri/Cargo.toml` passes.
- [ ] AC2: At least 2 Rust unit tests exist for the publish plan builder.
