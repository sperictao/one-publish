# TASK-0302: Advanced Parameter Editor

Status: done
Owner: OpenClaw
Links:
- PR: (tbd)

## Context

TASK-0301 implemented ParameterSchema and Renderer. Now we need a UI component that can generate form controls based on provider schemas, allowing users to edit parameters for any language provider.

## Goals

- Create a generic ParameterEditor component that renders form controls based on schema
- Support all parameter types: boolean, string, array, map
- Provide a user-friendly interface for editing complex parameters
- Integrate with existing App.tsx (or replace current .NET-specific form)

## Non-Goals

- Auto-detection of parameter values from existing commands (that's TASK-0303)
- Visual parameter editors (sliders, color pickers, etc.)
- Parameter validation UI (basic validation is OK)

## User Stories

- As a developer, I want to see all available parameters for a provider so I can configure builds correctly.
- As a developer, I want to edit array and map parameters without writing JSON manually.

## Requirements

### Functional

- R1: ParameterEditor accepts schema and renders appropriate UI for each parameter type
- R2: Boolean parameters render as toggle switches
- R3: String parameters render as text inputs
- R4: Array parameters render as dynamic lists with add/remove buttons
- R5: Map parameters render as key-value pairs with add/remove buttons
- R6: Component emits parameter changes to parent
- R7: Show parameter descriptions as tooltips or help text

### Non-Functional

- N1: Component is reusable across all providers
- N2: Responsive design (works on different screen sizes)
- N3: Good accessibility (keyboard navigation, ARIA labels)

## UX Notes

### Entry Points

- Main publish panel (replace or enhance current .NET form)
- Settings dialog (advanced mode)

### States

- Loading: Fetching provider schema
- Ready: Schema loaded, form rendered
- Error: Schema fetch failed

### Empty/Error States

- Empty: Show "No parameters defined for this provider"
- Error: Show error message with retry button

## Technical Design

### Component Structure

```typescript
// src/components/publish/ParameterEditor.tsx
interface ParameterEditorProps {
  schema: ParameterSchema;
  parameters: Record<string, SpecValue>;
  onChange: (params: Record<string, SpecValue>) => void;
}

// src/components/publish/BooleanParameter.tsx
// src/components/publish/StringParameter.tsx
// src/components/publish/ArrayParameter.tsx
// src/components/publish/MapParameter.tsx
```

### Data Types

```typescript
interface ParameterSchema {
  parameters: Record<string, ParameterDefinition>;
}

interface ParameterDefinition {
  type: 'boolean' | 'string' | 'array' | 'map';
  flag: string;
  multiple?: boolean;
  prefix?: string;
  description?: string;
}
```

### API Integration

- Tauri command: `get_provider_schema(provider_id: string) -> ParameterSchema`
- Add to `src-tauri/src/commands.rs`:
  ```rust
  #[tauri::command]
  pub async fn get_provider_schema(provider_id: String) -> Result<ParameterSchema, String>
  ```

### Integration Points

- App.tsx: Fetch schema when provider changes
- ParameterEditor: Display and edit parameters
- compile: Send parameters to backend

## TDD Plan

### Test cases (write failing tests first)

- [x] Component renders boolean parameter as switch
- [x] Component renders string parameter as input
- [x] Component renders array parameter as list
- [x] Component renders map parameter as key-value pairs
- [x] Component emits changes when parameter value changes
- [x] Array parameter can add/remove items
- [x] Map parameter can add/remove entries
- [x] Component displays parameter descriptions

### Test types

- Unit: Component rendering with test props
- Integration: Schema fetch + form rendering
- E2E: User edits parameters and they persist

## Acceptance Criteria

- [x] AC1: All unit tests pass (Vitest)
- [x] AC2: ParameterEditor renders correctly for all 4 providers
- [x] AC3: User can edit and save parameter changes
- [x] AC4: Array/Map parameters support dynamic add/remove
- [x] AC5: Parameter descriptions are displayed

## Rollout / Migration

- Phase 1: Create new ParameterEditor component (parallel to existing UI)
- Phase 2: Add Tauri command for schema fetching
- Phase 3: Integrate into App.tsx as optional "Advanced Mode"
- Phase 4: Gradually replace .NET-specific form (if desired)

## Notes

- Use shadcn/ui components (Switch, Input, Button, Card)
- Consider CollapsiblePanel for grouping related parameters
- Array/Map editing can be simplified in v1 (text-based is OK)
- Consider adding "Reset to defaults" button

## Implementation Details

### Files Created

**TypeScript Types:**
- `src/types/parameters.ts` - ParameterSchema, ParameterDefinition, SpecValue types + conversion functions

**Components:**
- `src/components/publish/BooleanParameter.tsx` - Switch for boolean parameters
- `src/components/publish/StringParameter.tsx` - Input for string parameters
- `src/components/publish/ArrayParameter.tsx` - Dynamic list for array parameters
- `src/components/publish/MapParameter.tsx` - Key-value pairs for map parameters
- `src/components/publish/ParameterEditor.tsx` - Main editor component

**Tests:**
- `src/components/publish/__tests__/BooleanParameter.test.tsx`
- `src/components/publish/__tests__/StringParameter.test.tsx`
- `src/components/publish/__tests__/ArrayParameter.test.tsx`
- `src/components/publish/__tests__/MapParameter.test.tsx`

### Files Modified

**Rust Backend:**
- `src-tauri/src/commands.rs` - Added `get_provider_schema` command
- `src-tauri/src/lib.rs` - Registered `get_provider_schema` command

### Features Implemented

✅ **BooleanParameter:** Toggle switch with tooltip
✅ **StringParameter:** Text input with tooltip
✅ **ArrayParameter:** Dynamic list with Add/Remove buttons
✅ **MapParameter:** Key-value pairs with Add/Remove buttons
✅ **ParameterEditor:** Renders all parameter types based on schema
✅ **Tooltip Help:** Parameter descriptions shown as tooltips
✅ **Empty States:** Displayed when array/map has no items
✅ **Type Conversions:** ParameterValue ↔ SpecValue conversions

### Test Coverage

```
✓ BooleanParameter: 3 tests
✓ StringParameter: 3 tests
✓ ArrayParameter: 5 tests
✓ MapParameter: 6 tests
Total: 17 unit tests
```
