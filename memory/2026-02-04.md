# Memory - 2026-02-04

## TASK-0402: Environment Probing + Guided Fixes

### 完成内容 (Part 1 - Backend)

**创建任务文件：**
- `docs/roadmap/tasks/TASK-0402.md` - 完整的任务规范
- 更新 `docs/roadmap/TASKS.md` 标记为 doing

**实现后端功能：**

#### 1. 数据模型 (`src-tauri/src/environment/types.rs`)
- `IssueSeverity` - Critical/Warning/Info
- `IssueType` - MissingTool/OutdatedVersion/MissingDependency/IncompatibleVersion
- `FixType` - OpenUrl/RunCommand/CopyCommand/Manual
- `FixAction` - 修复操作定义
- `EnvironmentIssue` - 环境问题
- `ProviderStatus` - Provider 状态
- `EnvironmentCheckResult` - 环境检查结果
- 版本解析工具函数：`parse_version`, `parse_semver`, `compare_versions`
- 命令检测工具函数：`command_exists`, `command_path`

#### 2. Provider 检测实现

**Rust/Cargo (`src-tauri/src/environment/cargo_provider.rs`):**
- 检测 cargo 版本
- 平台特定修复：
  - macOS: Homebrew, rustup
  - Windows: winget, 下载页面
  - Linux: rustup, 下载页面
- 最小版本：1.70.0

**.NET (`src-tauri/src/environment/dotnet_provider.rs`):**
- 检测 dotnet SDK 版本
- 平台特定修复：
  - macOS: Homebrew, 下载页面
  - Windows: winget, 下载页面
  - Linux: Microsoft 文档, 下载页面
- 最小版本：6.0.0

**Go (`src-tauri/src/environment/go_provider.rs`):**
- 检测 Go 版本（解析 `go version` 输出）
- 平台特定修复：
  - macOS: Homebrew, 下载页面
  - Windows: winget, 下载页面
  - Linux: snap, 下载页面
- 最小版本：1.20

**Java (`src-tauri/src/environment/java_provider.rs`):**
- 检测 Java JDK 版本（支持 Java 8+ 格式）
- 平台特定修复：
  - macOS: Homebrew, Adoptium
  - Windows: winget (Temurin), Adoptium
  - Linux: apt (Ubuntu/Debian), Adoptium
- 最小版本：11

#### 3. Tauri 命令 (`src-tauri/src/commands.rs`)
- `run_environment_check()` - 运行完整环境检查
- `apply_fix(action)` - 应用修复操作
  - OpenUrl: 使用 `open` crate 打开 URL
  - RunCommand: 返回命令供用户手动执行（安全考虑）
  - CopyCommand: TODO - 使用 clipboard 插件
  - Manual: 返回标签文本

#### 4. 测试覆盖
- 所有版本解析函数的单元测试
- 所有 issue 创建函数的单元测试
- 所有平台特定修复函数的单元测试
- 集成测试：`test_check_environment`

**测试结果：** 64 tests passed, 0 failed

### 待完成 (Part 2 - Frontend)
- [ ] EnvironmentCheckDialog.tsx 组件
- [ ] EnvironmentIssueCard 组件
- [ ] Settings 页面集成环境检查按钮
- [ ] 状态指示器显示
- [ ] 前端 TypeScript 类型定义
- [ ] E2E 测试

### 待优化
- [ ] 缓存机制（5分钟）
- [ ] 发布前自动检查
- [ ] 依赖检测（如 OpenSSL for Rust）
- [ ] clipboard 插件集成
- [ ] Linux 平台支持优化

### 提交记录
- `c0e61eb` - feat(phase4): Create TASK-0402 Environment Probing + Guided Fixes
- `e16df2d` - feat(phase4): TASK-0402 Environment Detection Backend - Part 1

## 其他
- 推送 TASK-0401 完成的提交（9个commit）
